<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>今天吃什么？- 选餐卡牌</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .perspective-1000 { perspective: 1000px; }
        .preserve-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }
        
        /* 自定义过渡动画 */
        .card-inner {
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* 隐藏滚动条 */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 font-sans min-h-screen">

    <div class="max-w-4xl mx-auto p-4 md:p-8">
        <!-- Header -->
        <header class="text-center mb-10">
            <div class="inline-block p-3 bg-orange-100 rounded-full mb-4">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 text-orange-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"/><path d="M7 2v20"/><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"/></svg>
            </div>
            <h1 class="text-4xl font-bold text-slate-800 mb-2">今天吃什么？</h1>
            <p class="text-slate-500">点击卡牌翻转，或点击按钮随机抽取</p>
        </header>

        <!-- Controls -->
        <div class="flex flex-wrap justify-center gap-4 mb-10">
            <button id="randomBtn" class="flex items-center gap-2 px-6 py-3 rounded-full font-bold text-white bg-orange-500 hover:bg-orange-600 shadow-lg hover:shadow-orange-200 transition-all transform active:scale-95 disabled:bg-slate-400">
                <svg id="shuffleIcon" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 18h1.4c1.3 0 2.5-.6 3.3-1.7l6.1-8.6c.7-1.1 2-1.7 3.3-1.7H22"/><path d="m18 2 4 4-4 4"/><path d="M2 6h1.9c1.5 0 2.9.9 3.6 2.2"/><path d="M22 18h-5.9c-1.3 0-2.6-.7-3.3-1.8l-.5-.8"/><path d="m18 14 4 4-4 4"/></svg>
                <span id="btnText">随机抽取</span>
            </button>
            
            <button id="resetBtn" class="flex items-center gap-2 px-6 py-3 rounded-full font-bold bg-white text-slate-600 border border-slate-200 hover:bg-slate-50 transition-all">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
                重置卡牌
            </button>
        </div>

        <!-- Card Grid -->
        <div id="cardGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-6 mb-12">
            <!-- Cards will be injected here -->
        </div>

        <!-- Management Section -->
        <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-100">
            <h3 class="text-lg font-bold mb-4 text-slate-700">管理我的清单</h3>
            <form id="addForm" class="flex gap-2">
                <input
                    type="text"
                    id="newOptionInput"
                    placeholder="输入新的外卖名称..."
                    class="flex-1 px-4 py-2 rounded-xl border border-slate-200 focus:outline-none focus:ring-2 focus:ring-orange-500/20 focus:border-orange-500"
                    required
                >
                <button
                    type="submit"
                    class="p-2 bg-slate-800 text-white rounded-xl hover:bg-slate-900 transition-colors"
                >
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>
                </button>
            </form>
        </div>
    </div>

    <script>
        let options = ["阿香米线", "三仙儿米线", "拌将麻辣拌", "和府捞面", "米村拌饭"];
        let isSpinning = false;
        let selectedIndex = null;
        let flippedIndices = new Set();

        const cardGrid = document.getElementById('cardGrid');
        const randomBtn = document.getElementById('randomBtn');
        const resetBtn = document.getElementById('resetBtn');
        const addForm = document.getElementById('addForm');
        const newOptionInput = document.getElementById('newOptionInput');
        const shuffleIcon = document.getElementById('shuffleIcon');
        const btnText = document.getElementById('btnText');

        // 初始化渲染
        function renderCards() {
            cardGrid.innerHTML = '';
            options.forEach((option, index) => {
                const isFlipped = flippedIndices.has(index);
                const isHighlight = selectedIndex === index;

                const card = document.createElement('div');
                card.className = 'relative h-48 cursor-pointer group perspective-1000';
                card.onclick = () => toggleFlip(index);

                card.innerHTML = `
                    <div class="card-inner relative w-full h-full preserve-3d ${isFlipped ? 'rotate-y-180' : ''}">
                        <!-- Card Front -->
                        <div class="absolute inset-0 w-full h-full backface-hidden rounded-2xl shadow-md flex items-center justify-center p-4 border-2 transition-colors ${isHighlight ? 'bg-orange-50 border-orange-400' : 'bg-white border-transparent'}">
                            <div class="text-center">
                                <div class="w-12 h-12 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-3 text-slate-400 group-hover:bg-orange-100 group-hover:text-orange-500 transition-colors">?</div>
                                <span class="text-slate-300 font-medium text-sm">点击翻牌</span>
                            </div>
                        </div>
                        <!-- Card Back -->
                        <div class="absolute inset-0 w-full h-full backface-hidden rotate-y-180 rounded-2xl shadow-xl bg-orange-500 flex items-center justify-center p-4 border-2 border-orange-400">
                            <div class="text-center">
                                <span class="text-white font-bold text-lg leading-tight">${option}</span>
                            </div>
                        </div>
                    </div>
                    <!-- Remove button -->
                    <button onclick="event.stopPropagation(); removeOption(${index})" class="absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity shadow-lg">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>
                    </button>
                `;
                cardGrid.appendChild(card);
            });
        }

        function toggleFlip(index) {
            if (isSpinning) return;
            if (flippedIndices.has(index)) {
                flippedIndices.delete(index);
            } else {
                flippedIndices.add(index);
            }
            renderCards();
        }

        function removeOption(index) {
            options.splice(index, 1);
            flippedIndices.clear();
            selectedIndex = null;
            renderCards();
        }

        function handleRandomPick() {
            if (isSpinning || options.length === 0) return;

            isSpinning = true;
            selectedIndex = null;
            flippedIndices.clear();
            renderCards();

            shuffleIcon.classList.add('animate-spin');
            btnText.innerText = '正在挑选...';
            randomBtn.disabled = true;

            let counter = 0;
            const totalSteps = 15;
            const interval = setInterval(() => {
                selectedIndex = Math.floor(Math.random() * options.length);
                renderCards();
                counter++;

                if (counter >= totalSteps) {
                    clearInterval(interval);
                    isSpinning = false;
                    
                    // 确定最终结果
                    const finalIndex = Math.floor(Math.random() * options.length);
                    selectedIndex = finalIndex;
                    flippedIndices.add(finalIndex);
                    
                    shuffleIcon.classList.remove('animate-spin');
                    btnText.innerText = '随机抽取';
                    randomBtn.disabled = false;
                    renderCards();
                }
            }, 100);
        }

        // 事件监听
        randomBtn.addEventListener('click', handleRandomPick);

        resetBtn.addEventListener('click', () => {
            flippedIndices.clear();
            selectedIndex = null;
            renderCards();
        });

        addForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const val = newOptionInput.value.trim();
            if (val) {
                options.push(val);
                newOptionInput.value = '';
                renderCards();
            }
        });

        // 初始渲染
        renderCards();
    </script>
</body>
</html>